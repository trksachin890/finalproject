{% extends 'core/base.html' %}
{% load static %}

{% block content %}
<div class="bg-gray-100 min-h-screen">
    <!-- Hero Section with Gradient -->
    <div class="bg-gradient-to-r from-black to-gray-800 text-white py-12 mb-8 relative overflow-hidden">
        <!-- Decorative grid pattern overlay -->
        <div class="absolute inset-0 opacity-10">
            <div class="h-full w-full" style="background-image: url('data:image/svg+xml,%3Csvg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22%3E%3Cpath fill=%22none%22 stroke=%22%23FFFFFF%22 stroke-width=%220.25%22 d=%22M0,0 L100,0 100,100 0,100z%22/%3E%3Cpath fill=%22none%22 stroke=%22%23FFFFFF%22 stroke-width=%220.25%22 d=%22M10,0 L10,100 M20,0 L20,100 M30,0 L30,100 M40,0 L40,100 M50,0 L50,100 M60,0 L60,100 M70,0 L70,100 M80,0 L80,100 M90,0 L90,100 M0,10 L100,10 M0,20 L100,20 M0,30 L100,30 M0,40 L100,40 M0,50 L100,50 M0,60 L100,60 M0,70 L100,70 M0,80 L100,80 M0,90 L100,90%22/%3E%3C/svg%3E');"></div>
        </div>
        <div class="container mx-auto px-4 relative z-10">
            <div class="flex items-center space-x-4">
                <!-- User avatar circle -->
                <div class="w-16 h-16 bg-gray-700 rounded-full flex items-center justify-center border-2 border-white text-2xl font-bold">
                    {{ user.first_name|slice:":1" }}{{ user.last_name|slice:":1" }}
                </div>
                <div>
                    <h1 class="text-4xl font-bold mb-1">Welcome, {{ user.first_name }}!</h1>
                    <p class="text-gray-300">Manage your automotive profile and preferences</p>
                </div>
            </div>
        </div>
    </div>

    <div class="container mx-auto px-4 pb-8">
        <!-- Dashboard Stats -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
            <div class="bg-white shadow-md rounded-lg p-4 border-l-4 border-blue-500">
                <p class="text-sm text-gray-500">Total Orders</p>
                <div class="flex items-center justify-between">
                    <p class="text-2xl font-bold">
                        {% if order_details %}
                            {{ order_details|length }}
                        {% else %}
                            0
                        {% endif %}
                    </p>
                    <div class="text-blue-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8 4-8-4V5l8 4 8-4v2zM4 13.8V7.2l8 4 8-4v6.6l-8 4-8-4z" />
                        </svg>
                    </div>
                </div>
            </div>
            <div class="bg-white shadow-md rounded-lg p-4 border-l-4 border-green-500">
                <p class="text-sm text-gray-500">Last Purchase</p>
                <div class="flex items-center justify-between">
                    <p class="text-2xl font-bold">
                        {% if order_details %}
                            {{ order_details.0.order.date }}
                        {% else %}
                            N/A
                        {% endif %}
                    </p>
                    <div class="text-green-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                        </svg>
                    </div>
                </div>
            </div>
            <div class="bg-white shadow-md rounded-lg p-4 border-l-4 border-purple-500">
                <p class="text-sm text-gray-500">Total Spent</p>
                <div class="flex items-center justify-between">
                    <p class="text-2xl font-bold">
                        {% if total_spent %}
                            NPR. {{ total_spent }}
                        {% else %}
                            NPR. 0
                        {% endif %}
                    </p>
                    <div class="text-purple-500">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                    </div>
                </div>
            </div>
        </div>

        <!-- Profile and Car Info Grid -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
            <!-- Profile Card -->
            <div class="bg-white shadow-md rounded-lg overflow-hidden">
                <div class="bg-gradient-to-r from-gray-800 to-gray-900 text-white p-4">
                    <h2 class="text-2xl font-semibold">Profile Information</h2>
                    <p class="text-gray-300 text-sm">Your account details</p>
                </div>
                <div class="p-6 space-y-4">
                    <div class="flex items-center space-x-3 pb-3 border-b border-gray-100">
                        <div class="text-gray-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                            </svg>
                        </div>
                        <div>
                            <p class="text-gray-600 text-sm">Username</p>
                            <p class="font-medium">{{ user.username }}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3 pb-3 border-b border-gray-100">
                        <div class="text-gray-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                            </svg>
                        </div>
                        <div>
                            <p class="text-gray-600 text-sm">Email</p>
                            <p class="font-medium">{{ user.email }}</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3 pb-3 border-b border-gray-100">
                        <div class="text-gray-400">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                            </svg>
                        </div>
                        <div>
                            <p class="text-gray-600 text-sm">Full Name</p>
                            <p class="font-medium">{{ user.first_name }} {{ user.last_name }}</p>
                        </div>
                    </div>
                    <a href="{% url 'password_change' %}" class="inline-block bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-4 rounded w-full text-center transition duration-200 ease-in-out transform hover:-translate-y-1">
                        <div class="flex items-center justify-center space-x-2">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z" />
                            </svg>
                            <span>Change Password</span>
                        </div>
                    </a>
                </div>
            </div>

            <!-- Recent Orders -->
            <div class="bg-white shadow-md rounded-lg overflow-hidden md:col-span-2">
                <div class="bg-gradient-to-r from-blue-800 to-blue-900 text-white p-4">
                    <h2 class="text-2xl font-semibold">My Orders</h2>
                    <p class="text-blue-200 text-sm">Your purchase history</p>
                </div>

                <div class="p-6">
                    {% if order_details %}
                        <div id="latest-order">
                            <!-- Show only the latest order -->
                            {% with order_details.0 as latest_order %}
                                <div class="bg-blue-50 border border-blue-100 rounded-lg p-4 mb-4">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <div class="flex items-center space-x-2">
                                                <p class="font-bold text-lg">Order #{{ latest_order.order.id }}</p>
                                                <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Completed</span>
                                            </div>
                                            <p class="text-sm text-gray-500">Ordered on: {{ latest_order.order.date }}</p>
                                        </div>
                                        <div class="text-right">
                                            <p class="text-sm text-gray-500">Total Amount</p>
                                            <p class="font-bold text-lg text-blue-700">NPR. {{ latest_order.order_total }}</p>
                                        </div>
                                    </div>

                                    <hr class="my-3 border-blue-100">

                                    <!-- Show Ordered Products -->
                                    <ul class="space-y-2">
                                        {% for item in latest_order.items %}
                                            <li class="flex justify-between items-center">
                                                <div class="flex items-center space-x-2">
                                                    <div class="w-8 h-8 bg-blue-200 rounded-full flex items-center justify-center text-blue-700 text-xs font-bold">
                                                        {{ item.product.name|slice:":1" }}
                                                    </div>
                                                    <div>
                                                        <a href="{% url 'product_detail' item.product.id %}" class="text-blue-600 hover:underline font-medium">
                                                            {{ item.product.name|truncatewords:3 }}
                                                        </a>
                                                        <p class="text-xs text-gray-500">Qty: {{ item.quantity }}</p>
                                                    </div>
                                                </div>
                                                <p class="font-medium">NPR. {{ item.total }}</p>
                                            </li>
                                        {% endfor %}
                                    </ul>
                                </div>
                            {% endwith %}
                        </div>

                        <!-- Hidden section for all orders -->
                        <div id="all-orders" class="hidden space-y-4">
                            {% for order_data in order_details|slice:"1:" %} <!-- Show all except the first order -->
                            <div class="bg-gray-50 border border-gray-200 rounded-lg p-4">
                                <div class="flex justify-between items-start">
                                    <div>
                                        <div class="flex items-center space-x-2">
                                            <p class="font-bold">Order #{{ order_data.order.id }}</p>
                                            <span class="bg-green-100 text-green-800 text-xs px-2 py-1 rounded-full">Completed</span>
                                        </div>
                                        <p class="text-sm text-gray-500">Ordered on: {{ order_data.order.date }}</p>
                                    </div>
                                    <div class="text-right">
                                        <p class="text-sm text-gray-500">Total Amount</p>
                                        <p class="font-bold text-blue-700">NPR. {{ order_data.order_total }}</p>
                                    </div>
                                </div>

                                <hr class="my-3 border-gray-200">

                                <!-- Show Ordered Products -->
                                <ul class="space-y-2">
                                    {% for item in order_data.items %}
                                        <li class="flex justify-between items-center">
                                            <div class="flex items-center space-x-2">
                                                <div class="w-8 h-8 bg-gray-200 rounded-full flex items-center justify-center text-gray-700 text-xs font-bold">
                                                    {{ item.product.name|slice:":1" }}
                                                </div>
                                                <div>
                                                    <a href="{% url 'product_detail' item.product.id %}" class="text-blue-600 hover:underline font-medium">
                                                        {{ item.product.name|truncatewords:3 }}
                                                    </a>
                                                    <p class="text-xs text-gray-500">Qty: {{ item.quantity }}</p>
                                                </div>
                                            </div>
                                            <p class="font-medium">NPR. {{ item.total }}</p>
                                        </li>
                                    {% endfor %}
                                </ul>
                            </div>
                            {% endfor %}
                        </div>

                        <!-- See More and See Less Buttons -->
                        {% if order_details|length > 1 %}
                        <div class="flex space-x-2">
                            <button id="see-more-btn" class="mt-4 bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded transition duration-200 ease-in-out flex items-center space-x-1">
                                <span>See More</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                                </svg>
                            </button>
                            <button id="see-less-btn" class="mt-4 bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded transition duration-200 ease-in-out hidden flex items-center space-x-1">
                                <span>See Less</span>
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 15l7-7 7 7" />
                                </svg>
                            </button>
                        </div>
                        {% endif %}

                        <!-- Show Total Amount Spent -->
                        <div class="mt-6 bg-gradient-to-r from-gray-800 to-gray-900 text-white p-4 rounded-lg">
                            <div class="flex justify-between items-center">
                                <h3 class="text-xl font-semibold">Total Spent</h3>
                                <p class="text-2xl font-bold">NPR. {{ total_spent }}</p>
                            </div>
                            <!-- Visual progress bar -->
                            <div class="mt-2 h-2 bg-gray-700 rounded-full overflow-hidden">
                                <div class="h-full bg-white rounded-full" style="width: 65%;"></div>
                            </div>
                        </div>

                    {% else %}
                        <div class="text-center py-8">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 7l-8 4-8-4V5l8 4 8-4v2zM4 13.8V7.2l8 4 8-4v6.6l-8 4-8-4z" />
                            </svg>
                            <p class="text-gray-500 text-center">No orders placed yet.</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- JavaScript for "See More" & "See Less" -->
<script>
document.addEventListener("DOMContentLoaded", function () {
    let seeMoreBtn = document.getElementById("see-more-btn");
    let seeLessBtn = document.getElementById("see-less-btn");
    let allOrders = document.getElementById("all-orders");

    if (seeMoreBtn && seeLessBtn) {
        seeMoreBtn.addEventListener("click", function () {
            allOrders.classList.remove("hidden"); // Show all orders
            seeMoreBtn.classList.add("hidden"); // Hide "See More"
            seeLessBtn.classList.remove("hidden"); // Show "See Less"
        });

        seeLessBtn.addEventListener("click", function () {
            allOrders.classList.add("hidden"); // Hide all orders
            seeMoreBtn.classList.remove("hidden"); // Show "See More"
            seeLessBtn.classList.add("hidden"); // Hide "See Less"
        });
    }
});
</script>
{% endblock %}